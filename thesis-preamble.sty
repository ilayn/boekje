%!TEX root = thesis.tex
\ProvidesPackage{thesis-preamble}

%%%%%%%%%%%%%%%%%%%%%
%! MEMOIR CUSTOMISE
%
\maxsecnumdepth{subsection} % number subsections
\maxtocdepth{subsection} % include subsections in ToC

\renewcommand{\cftchapterpagefont}{}
\renewcommand{\cftchapterfont}{} % no bold!
\renewcommand\cftdotsep{999} % no dots

% for page numbers:
\newcommand\thesispage{\normalfont \thepage}

%%% CHAPTERS
\makechapterstyle{phdstayla}{%
  \setlength\beforechapskip{0pt}
  \setlength\midchapskip{0pt}
  \setlength\afterchapskip{40pt}
  \renewcommand\chapnamefont{\normalfont\centering\large\scshape\MakeLowercase}
  \renewcommand\chapnumfont{\normalfont\centering\fontsize{60pt}{0pt}\selectfont}
  \renewcommand\chaptitlefont{\normalfont\HUGE\bfseries\centering}
  \renewcommand\printchaptername{\marginpar{\chapnamefont{\@chapapp}}}
  \renewcommand\chapternamenum{}
  \renewcommand\printchapternum{\marginpar{\chapnumfont\thechapter}}
    %\makeoddfoot{plain}{}{\thesispage}{}
}
\chapterstyle{phdstayla}





%%% SECTIONS
\newcommand\marginnum[2]{%
  \noindent
  \let\@tempa\relax
  \savebox\@tempboxa{#2}%
  %\null\marginpar{#1\@tempa}%
  #1\@tempa\quad#2}

\def\secstyle{\centering\scshape}
\def\subsecstyle{\centering\itshape}
\def\subsubsecstyle{\centering\small\itshape}

\setsecheadstyle{\marginnum\secstyle}
\setsubsecheadstyle{\marginnum\subsecstyle}
\setsubsubsecheadstyle{\marginnum\subsubsecstyle}
\setparaheadstyle{\normalfont\normalsize\scshape\addperiod}%


\setsecnumformat{\unexpanded{%
  %\protected@xdef\@tempa{{\upshape\S\csname the#1\endcsname}}}}
  \protected@xdef\@tempa{{\upshape\csname the#1\endcsname}}}}

%%%%%

\renewcommand\contentsname{Table Of Contents}
\nouppercaseheads

\def\printtoctitle#1{\section*{#1}}
\def\printloftitle#1{\section*{#1}}
\def\printlottitle#1{\section*{#1}}

% Page headers
\setlength{\headheight}{\baselineskip}
%\advance\headwidth by \textwidth + \marginparsep + 0.5\marginparwidth
\makepagestyle{phdstayla}
\makepsmarks{phdstayla}{%
  \let\@mkboth\markboth%
  \def\chaptermark##1{%
    \markboth{%
      \if@mainmatter
        \textsc{Chapter \thechapter:} %
      \fi
      ##1}{##1}}%
  \def\sectionmark##1{%
    \markright{%
      \if@mainmatter
        \textsc{\thesection:} %
      \fi
      ##1}}}
%\makerunningwidth{phdstayla}{\headwidth}
%\makeheadposition{phdstayla}{flushleft}{flushright}{}{}
\makeevenhead{phdstayla}{\thesispage}{}{\small\leftmark}
\makeoddhead{phdstayla} {\small\rightmark}{}{\thesispage}
\makeevenfoot{phdstayla}{}{}{}
\makeoddfoot{phdstayla}{}{}{}
\makeheadrule{phdstayla}{\textwidth}{0.3pt}

%\pagestyle{phdstayla}



%% Symmetric ragged commands
\newcommand\IfOddPage{%
  \checkoddpage
  \ifoddpage\expandafter\@firstoftwo
  \else\expandafter\@secondoftwo\fi}
\newcommand\raggedout{\IfOddPage\raggedright\raggedleft}
\newcommand\raggedin{\IfOddPage\raggedleft\raggedright}





%%% PACKAGES
\RequirePackage[T1]{fontenc}         % sane font encoding
\RequirePackage{lmodern}        % for sensible sans and tt font
\RequirePackage[sc,osf]{mathpazo}    % for math
\RequirePackage{microtype}
\RequirePackage[utf8]{inputenc}      % sane input encoding
\linespread{1.1}                     % Palatino needs more leading
\frenchspacing
\normalfont




\let\subcaption\undefined
\let\subfloat\undefined
\let\subfigure\undefined
\RequirePackage{subcaption}
\captionsetup{font={small}}
\captionsetup[table]{position=top}

%% Hyperref
\RequirePackage[ocgcolorlinks,%
								breaklinks,%
								plainpages=false,%
								pdfpagelabels,%
								linktocpage]{hyperref}
\AtBeginDocument{\hypersetup{pdfauthor={\@author},pdftitle={\@title}}}






\RequirePackage{
    graphicx, %
    amsmath,  %
    amssymb,  %
    amsthm,
    tikz,     % Requires at least v2.10 !!
    bm,       %
    pgfplots, % Requires at least v1.5.1 !!
    pgfplotstable,
    mathtools,
    booktabs,
    colortbl,
		enumitem,
		wrapfig,
		multirow,
		kantlipsum % For dummy text generation
}


\pgfplotsset{compat=newest}


\RequirePackage{siunitx}
\sisetup{mode = math,
open-bracket={[},close-bracket={]},
per-mode=symbol,
range-units=brackets,
range-phrase={,},
binary-units = true
}



\definecolor{darkred}{rgb}{0.4,0,0}
\definecolor{darkgreen}{rgb}{0,0.4,0}
\definecolor{darkblue}{rgb}{0,0,0.4}
\hypersetup{
  linkcolor=darkred,%
	citecolor=darkblue,%
	filecolor=black,%
	urlcolor=black%
}


\usetikzlibrary{arrows,
        calc,%
				matrix,%
				positioning,%
				decorations.markings,%
				patterns,
				matrix,%
        circuits.ee.IEC,
				shapes.arrows,
				shapes.geometric,
				plotmarks,
				decorations.pathmorphing
				}
\usepgfplotslibrary{smithchart,units}


\RequirePackage{csquotes}
%\MakeOuterQuote{''}



\RequirePackage{caption}
\captionsetup[table]{position=top}







%
%%% biblatex
\RequirePackage[
    backend=biber,
    hyperref,%
    backref,%
    sortcites,%
    date=short,%
    maxnames=5,%
    minnames=2,%
    firstinits=true,%
    bibstyle=numeric,%
    citestyle=numeric-comp,%
		%style=ieee
  ]{biblatex}


\@ifpackageloaded{biblatex}{\addbibresource{phdthesis.bib}}{\bibliography{phdthesis}}

\def\bibfont{\small}
\AtEveryBibitem{%
  \clearfield{isbn}
  \clearfield{issn}
  \clearfield{month}
}
\setcounter{biburlnumpenalty}{100}
\setcounter{biburlucpenalty}{100}
\setcounter{biburllcpenalty}{100}


\newbibmacro*{bbx:parunit}{%
  \ifbibliography
    {\setunit{\bibpagerefpunct}\newblock
     \usebibmacro{pageref}%
     \clearlist{pageref}%
     \setunit{\adddot\par\nobreak}}
    {}}

\renewbibmacro*{doi+eprint+url}{%
  \usebibmacro{bbx:parunit}% Added
  \iftoggle{bbx:doi}
    {\printfield{doi}}
    {}%
  \iftoggle{bbx:eprint}
    {\usebibmacro{eprint}}
    {}%
  \iftoggle{bbx:url}
    {\usebibmacro{url+urldate}}
    {}}

\renewbibmacro*{eprint}{%
  \usebibmacro{bbx:parunit}% Added
  \iffieldundef{eprinttype}
    {\printfield{eprint}}
    {\printfield[eprint:\strfield{eprinttype}]{eprint}}}

\renewbibmacro*{url+urldate}{%
  \usebibmacro{bbx:parunit}% Added
  \printfield{url}%
  \iffieldundef{urlyear}
    {}
    {\setunit*{\addspace}%
     \printtext[urldate]{\printurldate}
    }
    }
    



%\ExecuteBibliographyOptions{doi=false}
%\newbibmacro{string+doi}[1]{%
  %\iffieldundef{doi}{#1}{\href{http://dx.doi.org/\thefield{doi}}{#1}}}
%\DeclareFieldFormat{title}{\usebibmacro{string+doi}{\mkbibemph{#1}}}
%\DeclareFieldFormat[article]{title}{\usebibmacro{string+doi}{\mkbibquote{#1}}}

\usepackage{docmute}

%%%%%%%%%%%%%%%%%%%%

% MATHS
%\RequirePackage{amsmath,amssymb,bm,cool,mathtools}%,fngp
%\@ifpackageloaded{mathpazo}{\PassOptionsToPackage{mathpazo}{flexisym}}{}
%\RequirePackage{breqn}
%\setkeys{breqn}{labelprefix=eq:}

%%%%%%%%%%%%%%%%%
%%% FIGURES


%\let\subfloat\subbottom

\def\impath{images/}

%\newcommand\grf[2][]{\includegraphics[#1]{\impath #2}}



%%%%%%%%%%%%%
%! FLOATS
%\renewcommand{\topfraction}{.8}
%\renewcommand{\bottomfraction}{.3}
%\renewcommand{\textfraction}{.15}
%\renewcommand{\floatpagefraction}{.66}
%\renewcommand{\dbltopfraction}{.66}
%\renewcommand{\dblfloatpagefraction}{.66}
%\setcounter{topnumber}{9}
%\setcounter{bottomnumber}{9}
%\setcounter{totalnumber}{20}
%\setcounter{dbltopnumber}{9}
%
%\renewenvironment{figure}[1][\fps@figure]
                 %{\edef\@tempa{\noexpand\@float{figure}[#1]}
                  %\@tempa\capstart\centering}
                 %{\end@float}
%\renewenvironment{table}[1][\fps@table]
                 %{\edef\@tempa{\noexpand\@float{table}[#1]}
                  %\@tempa\capstart\centering}
                 %{\end@float}
%

%% Floats & captions
%\captionnamefont{\scshape}
%\setlength\captionwidth{0.9\linewidth}
%\changecaptionwidth
%
%\newcommand\lofcaption[2]{\caption[#1]{#1#2}}
%\DeclareRobustCommand\periodifnocomma{\@ifnextchar,{}{.}}

%%%%%%%%%%%%
% These are the varioref definitions:
% \newcommand{\varioprefix}{See~}
% \newcommand{\myvariohook}[1]{\marginpar{\small\centering \varioprefix #1}}
% \def\reftextcurrent{}
% \def\reftextfaceafter{}
% \def\reftextfacebefore{}
% \def\reftextafter{~on the \reftextvario{following}{next} page}
% \def\reftextbefore{~on the \reftextvario{previous page}{preceding page}}
% \def\reftextafter{}
% \def\reftextbefore{}
% \def\reftextfaraway#1{\myvariohook{p.\,\pageref{#1}}}
% \def\reftextpagerange#1#2{\myvariohook{pp.\,\pageref{#1}--\pageref{#2}}}



%\RequirePackage[open,openlevel=4]{bookmark}
\RequirePackage{cleveref}
\Crefname{secinapp}{Appendix}{Appendices}
\Crefname{thm}{Theorem}{Theorems}
\Crefname{lem}{Lemma}{Lemmas}
\Crefname{rem}{Remark}{Remarks}
\Crefname{define}{Definition}{Definitions}
\Crefname{coroll}{Corollary}{Corollaries}





\renewcommand\cftchapterfont{\scshape}
\renewcommand\cftsectionfont{\normalfont}
\renewcommand\cftsubsectionfont{\itshape\small}
\renewcommand\cftsubsectionpagefont{\upshape\small}






%======== Thm style declaration
\newtheorem{thm}{Theorem}[chapter]
\newtheorem{coroll}[thm]{Corollary}
\newtheorem{define}[thm]{Definition}
\newtheorem{lem}[thm]{Lemma}
\newtheorem{rem}[thm]{Remark}
%\renewcommand{\thetheorem}{\arabic{chapter}.\arabic{theorem}}

%======== Shorthand notation
\newcommand{\Real}{\mathbb{R}}
\newcommand{\Realext}{\mathbb{R}_e}
\newcommand{\Complex}{\mathbb{C}}
\newcommand{\LL}{\mathcal{L}}
\newcommand{\HH}{\mathcal{H}}
\newcommand{\RH}{\mathcal{RH}}
\newcommand{\iw}{i\omega}
\newcommand{\eiw}{e^{i\omega}}
\newcommand{\eiwt}{e^{i2\pi\omega t}}
\newcommand{\eniw}{e^{-i\omega}}
\newcommand{\eniwt}{e^{-i2\pi\omega t}}
\newcommand{\infint}[1]{\int_{-\infty}^\infty{#1}}
\newcommand{\fourier}[1]{\infint{#1\eniwt dt}}
\newcommand{\ifourier}[1]{\infint{#1\eiwt dt}}
\newcommand{\bmatr}[1]{\begin{bmatrix}#1\end{bmatrix}}
\newcommand{\pmatr}[1]{\begin{pmatrix}#1\end{pmatrix}}
\newcommand{\smallbmatr}[1]{\ensuremath{\left[\begin{smallmatrix}#1\end{smallmatrix}\right]}}
\newcommand{\smallpmatr}[1]{\ensuremath{\left(\begin{smallmatrix}#1\end{smallmatrix}\right)}}
\newcommand{\statespace}[4]{\ensuremath{\left[\begin{array}{c|c}#1 &#2\\\hline #3 &#4\end{array}\right]}}
\newcommand{\inv}[1]{#1^{-1}}
\newcommand{\quaQ}{\mathcal{Q}}
\DeclareMathOperator{\inertia}{in}
\DeclareMathOperator{\trace}{tr}
\providecommand{\abs}[1]{\displaystyle \left|#1\right|}
\providecommand{\norm}[1]{\displaystyle \left\| #1 \right\|}
\renewcommand{\Re}[1]{\operatorname{Re}\left\{ #1 \right\}}
\renewcommand{\Im}[1]{\operatorname{Im}\left\{ #1 \right\}}

%==================================================
% ==== A style definition used in some Tikz-picture
%==================================================
\tikzset{ssmatrix/.style={matrix of math nodes,
													left delimiter={[},
													right delimiter={]},
													ampersand replacement=\&,
													nodes={
																outer sep=0,
																inner sep=0.2ex,
																font=\footnotesize
																},
													inner sep=0,
													outer sep=0,
													every left delimiter/.style={xshift=0.1ex},
													every right delimiter/.style={xshift=-0.1ex}}
}

\pgfdeclarefunctionalshading{eightball}{\pgfpointorigin}{\pgfpoint{100bp}{100bp}}{}{
50 sub dup mul exch
70 sub dup mul 0.5 mul add sqrt  
dup mul neg 1.003 exch exp 1 exch sub
dup
dup
}
\makeatletter
\pgfdeclareplotmark{o*}
{%
\pgfcoordinate{tpt-\the\pgf@plot@mark@count}{\pgfpointorigin}
  \pgfpathcircle{\pgfpointorigin}{\pgfplotmarksize}
  \pgfusepathqfillstroke
}

% http://tex.stackexchange.com/questions/52786/din-conform-arrowheads-and-hatching-in-tikz
\pgfarrowsdeclare{DIN}{DIN}
{
  \pgfutil@tempdima=0.5pt%
  \advance\pgfutil@tempdima by.25\pgflinewidth%
  \pgfutil@tempdimb=7.29\pgfutil@tempdima\advance\pgfutil@tempdimb by.5\pgflinewidth%
  \pgfarrowsleftextend{+-\pgfutil@tempdimb}
  \pgfutil@tempdimb=.5\pgfutil@tempdima\advance\pgfutil@tempdimb by1.6\pgflinewidth%
  \pgfarrowsrightextend{+\pgfutil@tempdimb}
}
{
  \pgfutil@tempdima=0.5pt%
  \advance\pgfutil@tempdima by.25\pgflinewidth%
  \pgfsetdash{}{+0pt}
  \pgfsetmiterjoin
  \pgfpathmoveto{\pgfpointadd{\pgfqpoint{0.5\pgfutil@tempdima}{0pt}}{\pgfqpoint{-4mm}{0.5mm}}}
  \pgfpathlineto{\pgfqpoint{0.5\pgfutil@tempdima}{0\pgfutil@tempdima}}
  \pgfpathlineto{\pgfpointadd{\pgfqpoint{0.5\pgfutil@tempdima}{0pt}}{\pgfqpoint{-4mm}{-0.5mm}}}
  \pgfpathclose
  \pgfusepathqfillstroke
}
\pgfarrowsdeclarereversed{DIN reversed}{DIN reversed}{DIN}{DIN}
\makeatother



